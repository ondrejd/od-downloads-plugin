<?php
/**
 * Template file for widget "Soubory ke stažení".
 *
 * @author  Ondřej Doněk, <ondrejd@gmail.com>
 * @license https://www.gnu.org/licenses/gpl-3.0.en.html GNU General Public License 3.0
 * @package odwp-downloads_plugin
 * 
 * @todo Format dates by WordPress inner function!
 */

if ( ! defined( 'ABSPATH' ) ) {
    exit();
}

/**
 * Used parameters (taken from {@see odwpdp_widget_1::widget()}).
 *
 * @param array $args
 * @param array $instance
 * @param array $files
 */

// Starts widget
echo $args['before_widget'];

// Widget's title
if ( ! empty( $instance['title'] ) ) {
    echo $args['before_title'] . apply_filters( 'widget_title', $instance['title'] ) . $args['after_title'];
}

?>
<div class="odwpdp-widget-1">
    <ul class="files-list">
        <?php foreach ( $files as $file ) :
            $puton_date  = get_post_meta( $file->ID, 'odwpdp-metabox-1', true );
            $putoff_date = get_post_meta( $file->ID, 'odwpdp-metabox-2', true );
            $file_name   = get_post_meta( $file->ID, 'odwpdp-metabox-3', true );
            $file_info   = odwpdp_get_file_info( $file_name );
        ?>
        <li>
            <span class="file-info-cont file-info-cont-small">
                <img src="<?php echo $file_info['icon_32']; ?>" class="file-icon">
                <?php printf(
                    '<span class="file-info">' .
                        '<a href="%s" class="file-link">%s</a><br>' .
                        '<small class="file-size">%s</small>&nbsp;|&nbsp;' .
                        '<small class="file-dates" title="%s">%s/%s</small>' .
                    '</span>',
                    $file_info['url'],
                    $file->post_title,
                    $file_info['size'],
                    __( 'Datum vyvěšení/sejmutí', ODWPDP_SLUG ),
                    ( ! empty( $puton_date ) ) ? date( 'j.n.Y', strtotime( $puton_date ) ) : '---',
                    ( ! empty( $putoff_date ) ) ? date( 'j.n.Y', strtotime( $putoff_date ) ) : '---'
                ); ?>
            </span>
        </li>
        <?php endforeach; ?>
    </ul>
</div>
<?php

// Ends widget
echo $args['after_widget'];